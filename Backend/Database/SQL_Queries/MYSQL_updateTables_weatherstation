-- Create temp tables
DROP TABLE IF EXISTS temp_weather_data;

DROP TABLE IF EXISTS temp_dates;

DROP TABLE IF EXISTS temp_stations;


CREATE TABLE temp_stations AS 
SELECT *
FROM stations;

CREATE TABLE temp_dates AS 
SELECT *
FROM Dates;

CREATE TABLE temp_weather_data AS 
SELECT *
FROM weather_data;


-- DROP TABLES
DROP TABLE IF EXISTS weather_data;

DROP TABLE IF EXISTS Dates;

DROP TABLE IF EXISTS stations;

-- ---- STATIONS TABLE------

CREATE TABLE stations (
    station_id   NUMERIC (8)    NOT NULL,
    `Station Name` VARCHAR (30)      NOT NULL,
    state        VARCHAR (3)       NOT NULL,
    dist         NUMERIC (3)    NOT NULL,
    lat          NUMERIC (8, 3) NOT NULL,
    lon          NUMERIC (8, 3) NOT NULL,
    PRIMARY KEY (`Station Name`)
);

INSERT INTO stations (
                         station_id,
                         `Station Name`,
                         state,
                         dist,
                         lat,
                         lon
                     )
                     SELECT station_id,
                            `Station Name`,
                            state,
                            dist,
                            lat,
                            lon
                       FROM temp_stations;

DROP TABLE temp_stations;



-- --DATES TABLE-----


CREATE TABLE Dates (
    Date  DATE        NOT NULL
                      PRIMARY KEY,
    Month VARCHAR (3)    NOT NULL,
    Year  NUMERIC (4) NOT NULL,
    Quarter NUMERIC (1) NOT NULL
);

INSERT INTO Dates (
                      Date,
                      Month,
                      Year
                  )
                  SELECT Date,
                         Month,
                         Year
                    FROM temp_dates;

DROP TABLE temp_dates;


-- ---STATION_DATA TABLE-----


CREATE TABLE weather_data (
    `Station Name`          VARCHAR (30) NOT NULL,
    Date                  DATE   NOT NULL,
    `Rain 0900-0900 (mm)`                  NUMERIC   ,
    `Maximum Temperature (°C)`              NUMERIC   ,
    `Minimum Temperature (°C)`              NUMERIC   ,
    `Maximum Relative Humidity (%)` NUMERIC   ,
    `Minimum Relative Humidity (%)` NUMERIC   ,
    `Average 10m Wind Speed (m/sec)`     NUMERIC   ,

    PRIMARY KEY (`Station Name`, Date),
    CONSTRAINT stations_weather_data_fk
    FOREIGN KEY (`Station Name`) REFERENCES stations(`Station Name`) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT dates_weather_data_fk
    FOREIGN KEY (Date) REFERENCES Dates(Date) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO weather_data (
                             `Station Name`,
                             Date,
                             `Rain 0900-0900 (mm)`,
                             `Maximum Temperature (°C)`,
                             `Minimum Temperature (°C)`,
                             `Maximum Relative Humidity (%)`,
                             `Minimum Relative Humidity (%)`,
                             `Average 10m Wind Speed (m/sec)`
                         )
                         SELECT `Station Name`,
                                Date,
                                `Rain 0900-0900 (mm)`,
                                `Maximum Temperature (°C)`,
                                `Minimum Temperature (°C)`,
                                `Maximum Relative Humidity (%)`,
                                `Minimum Relative Humidity (%)`,
                                `Average 10m Wind Speed (m/sec)`
                           FROM temp_weather_data;

DROP TABLE temp_weather_data;





