-- SQLite
DROP TABLE IF EXISTS sqlitestudio_temp_table;
------STATIONS TABLE------
PRAGMA foreign_keys = 0;

CREATE TABLE sqlitestudio_temp_table AS SELECT *
                                          FROM stations;

DROP TABLE stations;

CREATE TABLE stations (
    station_id   NUMERIC (8)    NOT NULL,
    'Station Name' TEXT (30)      NOT NULL
                                PRIMARY KEY,
    state        TEXT (3)       NOT NULL,
    dist         NUMERIC (3)    NOT NULL,
    lat          NUMERIC (8, 3) NOT NULL,
    lon          NUMERIC (8, 3) NOT NULL
)
WITHOUT ROWID;

INSERT INTO stations (
                         station_id,
                         'Station Name',
                         state,
                         dist,
                         lat,
                         lon
                     )
                     SELECT station_id,
                            'Station Name',
                            state,
                            dist,
                            lat,
                            lon
                       FROM sqlitestudio_temp_table;

DROP TABLE sqlitestudio_temp_table;

PRAGMA foreign_keys = 1;




----DATES TABLE-----
PRAGMA foreign_keys = 0;

CREATE TABLE sqlitestudio_temp_table AS SELECT *
                                          FROM Dates;

DROP TABLE Dates;

CREATE TABLE Dates (
    Date  DATE        NOT NULL
                      PRIMARY KEY,
    Month TEXT (3)    NOT NULL,
    Year  NUMERIC (4) NOT NULL,
    Quarter NUMERIC (1) NOT NULL
);

INSERT INTO Dates (
                      Date,
                      Month,
                      Year
                  )
                  SELECT Date,
                         Month,
                         Year
                    FROM sqlitestudio_temp_table;

DROP TABLE sqlitestudio_temp_table;

PRAGMA foreign_keys = 1;



-----STATION_DATA TABLE-----
PRAGMA foreign_keys = 0;

CREATE TABLE sqlitestudio_temp_table AS SELECT *
                                          FROM weather_data;

DROP TABLE weather_data;

CREATE TABLE weather_data (
    'Station Name'          TEXT (30) REFERENCES stations ('Station Name') ON DELETE CASCADE
                                                                       ON UPDATE CASCADE
                                    NOT NULL,
    Date                  DATE      REFERENCES Dates (Date) ON DELETE CASCADE
                                                            ON UPDATE CASCADE
                                    NOT NULL,
    'Rain 0900-0900 (mm)'                  NUMERIC   ,
    'Maximum Temperature (°C)'              NUMERIC   ,
    'Minimum Temperature (°C)'              NUMERIC   ,
    'Maximum Relative Humidity (%)' NUMERIC   ,
    'Minimum Relative Humidity (%)' NUMERIC   ,
    'Average 10m Wind Speed (m/sec)'     NUMERIC   ,

    PRIMARY KEY ('Station Name', Date)
);

INSERT INTO weather_data (
                             'Station Name',
                             Date,
                             'Rain 0900-0900 (mm)',
                             'Maximum Temperature (°C)',
                             'Minimum Temperature (°C)',
                             'Maximum Relative Humidity (%)',
                             'Minimum Relative Humidity (%)',
                             'Average 10m Wind Speed (m/sec)'
                         )
                         SELECT 'Station Name',
                                Date,
                                'Rain 0900-0900 (mm)',
                                'Maximum Temperature (°C)',
                                'Minimum Temperature (°C)',
                                'Maximum Relative Humidity (%)',
                                'Minimum Relative Humidity (%)',
                                'Average 10m Wind Speed (m/sec)'
                           FROM sqlitestudio_temp_table;

DROP TABLE sqlitestudio_temp_table;

PRAGMA foreign_keys = 1;
